function startUpdateRequest(){asyncRequest("GET","/sim.json","","",function(t,e){200==t&&updateReceived(e)},document.getElementById("update-status"))}function updateReceived(t){data=JSON.parse(t),Object.keys(data.entities).includes(selectedEntity)||(selectedEntity=null),updateEntityCount(data.entities),renderEntities(data.entities),updateSelectedEntity(),setTimeout(startUpdateRequest,10)}function updateEntityCount(t){var e=Object(),n=Object.keys(t);for(i=0;i<n.length;i++){var a=t[n[i]].type;Object.keys(e).includes(a)?e[a]++:e[a]=1}var s=document.getElementById("entity-count");s.innerHTML="";n=Object.keys(entityTypes);for(i=0;i<n.length;i++){a=n[i];0<i&&(s.innerHTML+=", "),s.innerHTML+=a+": "+e[a]}}function renderEntities(t){canvasCtx.clearRect(0,0,canvas.width,canvas.height);var e=Object.keys(t);for(i=0;i<e.length;i++){var n,a=posToCanvas((n=t[e[i]]).pos),s=entityTypes[n.type].color,c=entityTypes[n.type].radius*canvasScale;canvasCtx.beginPath(),canvasCtx.arc(a[0],a[1],c,0,2*Math.PI,!1),canvasCtx.strokeStyle="#000000",canvasCtx.fillStyle=RGBToHex(s),canvasCtx.fill(),canvasCtx.moveTo(a[0],a[1]);s=new Vector(a[0],a[1]).add(Vector.fromAngle(n.orientation,2*c));canvasCtx.lineTo(s.v[0],s.v[1]),canvasCtx.stroke()}selectedEntity&&(a=posToCanvas((n=t[selectedEntity]).pos),c=entityTypes[n.type].radius*canvasScale,canvasCtx.beginPath(),canvasCtx.strokeStyle="#0000FF",canvasCtx.rect(a[0]-c,a[1]-c,2*c,2*c),canvasCtx.stroke())}function posToCanvas(t){return[t[0]*canvasScale,t[1]*canvasScale]}function updateSelectedEntity(){var t=data.entities[selectedEntity];elem=document.getElementById("entity-details"),elem.innerHTML="",elem.innerHTML+=null!=t?formatStringMatrix([["Type",t.type],["ID",selectedEntity],["Health",Math.round(100*t.health)+"%"],["Generation",t.gen]]):"Select entity for details"}function canvasClicked(t){var e=t.target.getBoundingClientRect(),n=t.clientX-e.left,a=t.clientY-e.top;selectedEntity=null;var s=data.entities,c=Object.keys(s);for(i=0;i<c.length;i++){var o=c[i],d=posToCanvas((t=s[o]).pos);new Vector(n,a).sub(new Vector(d[0],d[1])).abs()<=entityTypes[t.type].radius*canvasScale&&(selectedEntity=o)}updateSelectedEntity()}function setCanvasSize(){canvasScale=.8}window.onload=function(){setCanvasSize(),canvas=document.getElementById("main-canvas"),canvasCtx=canvas.getContext("2d"),selectedEntity=null,asyncRequest("GET","/settings.json","","",function(t,e){200==t&&(window.settings=JSON.parse(e),window.entityTypes=window.settings.entity_types,startUpdateRequest(),canvas.onclick=canvasClicked)},document.getElementById("entity-types-load-status"),["Loaded entity types","ERROR: could not load entity_types, check browser console"])};